name: release

on:
  # Triggers the workflow on push or pull request events but only for the main branch
  repository_dispatch:
  workflow_dispatch:

# A workflow run is made up of one or more jobs that can run sequentially or in parallel
jobs:
  # This workflow contains a single job called "build"
  build:
    # The type of runner that the job will run on
    runs-on: ubuntu-latest

    # Steps represent a sequence of tasks that will be executed as part of the job
    steps:
      - name: post cloudflare endpoint
        env:
          CF_ACCOUNT_ID: ${{secrets.CF_ACCOUNT_ID}}
          PROJECT_NAME: ${{secrets.CF_PROJECT_NAME}}
          CF_EMAIL: ${{secrets.CF_EMAIL}}
          CF_API_KEY: ${{secrets.CF_API_KEY}}
        run: |
          curl "https://api.cloudflare.com/client/v4/accounts/$CF_ACCOUNT_ID/pages/projects/$PROJECT_NAME/deployments" \
            -X POST \
            -s -o /dev/null \
            --header "X-Auth-Email: $CF_EMAIL" \
            --header "X-Auth-Key: $CF_API_KEY"
